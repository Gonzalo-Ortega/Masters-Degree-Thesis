\section{Preliminaries (to do work)}
The contents of this chapter are based on \cite{nanda}, \cite{polterovich} and \cite{wang}.

\begin{definition}[Graded ring]
    
\end{definition}

\begin{definition}[Graded ideal]
    
\end{definition}

\begin{definition}[Graded moudule]
    
\end{definition}

\begin{definition}[Persistance module, finite type]
%    $ (V, \pi) $, where $ V = \{V_t\}_{t \in \mathbb R} $ is a collection of finite dimensional vector spaces over a field $ \mathbb F $, and $ \pi = \{ \pi_{s \leq t} \} $ is a collection of linear maps $ \pi_{s \leq t}: V_s \rightarrow V_t $.
\end{definition}

\begin{definition}[Module morphism, shift]
    
\end{definition}

\begin{definition}[Interval module]
    
\end{definition}

\begin{definition}[Direct sum of persistance modules]
    
\end{definition}

\begin{definition}[Barcode]

\end{definition}

\begin{definition}[$\delta$-interleaving moudules]
    
\end{definition}

\begin{definition}[Interleaving distance]
    
\end{definition}

\begin{definition}[Multiset matching]
    
\end{definition}

\begin{definition}[$\delta$-matching barcodes] \label{delta-matching}
    
\end{definition}

\begin{definition}[Bottleneck distance]
    
\end{definition}

\begin{definition}[Induced matching]
    
\end{definition}

\newpage
\section{Structure Theorem}
\begin{fact}[Structure theorem for finitely generated modules over a principal ideal domain] \label{structure-pure}
    Let $ M $ be a  finitely generated module over a principal ideal domain. There exist a finite sequence of proper ideals $ (d_1) \supseteq (d_2) \supseteq \dots \supseteq (d_n) $ such that
    $$
        M \cong \bigoplus_{i=1}^n R / (d_i).
    $$

\end{fact}

\begin{proposition}
    An ideal $ I \subseteq R $ is graded if and only if it is generated by homogeneous elements.
\end{proposition}

\begin{theorem}[Structure] \label{structure}
    Let $ (V, \pi) $ be a persistence module. There exist a barcode $ \barc(V, \pi) $, with $ \mu : \barc (V, \pi) \longrightarrow \mathbb N $, the multiplicity of the barcode intervals, such as there is a unique direct sum decomposition
    $$
        V \cong \bigoplus_{I \in  \barc (V)} \mathbb F (I)^{\mu (I)}.
    $$
\end{theorem}
\begin{proof}
    (INCOMPLETE)
    $ V $ is of finite type, so it is a finite $ \mathbb F[x] $-module. As $ \mathbb F $ is a field, $ \mathbb F[x] $ is a principal ideal domain, therefore, $ V $ is a finitely generated module over a principal ideal domain. Using Fact \ref{structure-pure} $ V $ can be decompose in the direct sum of its free and torsion subgroups, $ F \oplus T $. Thus, we have
    \begin{align*}
        F &= \\
        T &= .
    \end{align*}
    
\end{proof}

\newpage
\section{Stability Theorem}

\begin{lemma} \label{interval-interleaving-if-matching} % Polterovich Exercise 2.2.7
    Let $ I, J $ be two $\delta$-matched intervals. Then, their corresponding interval modules $ (\mathbb F (I), \pi) $ and $( \mathbb F (J), \theta) $ are $\delta$-interleaved.
\end{lemma}
\begin{proof}
    Let $ I = (a, b] $, $ J = (c, d] $. If $\rho$ is the $\delta$-matching between them, then $ \rho(I) = J $ and, following Definition \ref{delta-matching}, $ (a, b] \subseteq (c-\delta, d+\delta] $ and $ (c, d] \subseteq (a-\delta, b+\delta] $, with $ b - a > 2\delta $ and $ d - c > 2\delta $. Then, the morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta: \mathbb F(I) &\to \mathbb F(J)_\delta\\
        \phi_\delta(\mathbb F(I)_t) &\mapsto \mathbb F(J)_{(t+\delta)}\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta: \mathbb F(J) &\to \mathbb F(I)_\delta\\
        \psi_\delta(\mathbb F(J)_t) &\mapsto \mathbb F(I)_{(t+\delta)}\\
        \end{aligned}
    \end{equation*}
    are well defined as for any $ t \in (a,b], \ t + \delta \in (c, d] $ as $ a + \delta > c $ and $ b + \delta \leq d $. In the same way, for any $ t \in (c,d], \ t + \delta \in (a, b] $. Thus, $ \psi_\delta \circ \phi_\delta (\mathbb F(I)_t) = \psi_\delta(\mathbb F(J)_{(t+\delta)}) = \mathbb F(I)_{(t+2\delta)} = \pi_{t \leq t+2\delta}(\mathbb F(I)_t)$ and $ \phi_\delta \circ \psi_\delta (\mathbb F(J)_t) = \phi_\delta(\mathbb F(I)_{(t+\delta)}) = \mathbb F(J)_{(t+2\delta)} = \theta_{t \leq t+2\delta}(\mathbb F(J)_t)$. Therefore, $ \phi_\delta $ and $ \psi_\delta $ are a pair of $\delta$-interleaving morphisms.
\end{proof}

\begin{proposition} \label{interleaving-if-mathing} % Polterovich Theorem 3.0.1
    Given two persistence modules $ V $, $ W $, if there is a $ \delta$-matching between their barcodes, then there is a $ \delta$-interleaving morphism between them.
\end{proposition}
\begin{proof}
    Suppose there is a $\delta$-matching between the barcodes of $ V $ and $ W $, $\rho: \barc (V) \to \barc (W) $. By the Structure Theorem \ref{structure}, $ V $ and $ W $ decompose in a finite direct sum of interval modules
    $$
        V \cong \! \bigoplus_{I \in \barc (V)} \mathbb F (I), \ \ W \cong \! \bigoplus_{J \in  \barc (W)} \mathbb F (W) .
    $$
    We can express $ V = V_Y \oplus V_N $, $ W = W_Y \oplus W_N $ denoting
    \begin{equation*}
        \begin{aligned}[c]
        V_Y &\cong \bigoplus_{I \in  \operatorname{coim} \rho} \mathbb F (I),\\
        V_N &\cong \bigoplus_{I \in \barc(V) \backslash \operatorname{coim} \rho} \mathbb F (I),\\
        \end{aligned}
        \quad \quad \quad
        \begin{aligned}[c]
        W_Y &\cong \bigoplus_{J \in  \operatorname{im} \rho} \mathbb F (J),\\
        W_N &\cong \bigoplus_{J \in \barc(J) \backslash \operatorname{im} \rho} \mathbb F (J).
        \end{aligned}
    \end{equation*}
    The $ V_Y, W_Y $ modules separate the ``yes, matched'' intervals, from the $ V_N, W_N $ ``not matched" intervals. For every interval $ I \in \barc(V_Y) $, $ I $ is $\delta$-matched to an interval $ J \in \barc(W_Y)$ by $\rho(I) = J $. Thus, by Lemma \ref{interval-interleaving-if-matching}, for all pair $ I, J $ of matched intervals, there exist a par of $\delta$-interleaved morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta: \mathbb F(I) &\to \mathbb F(J)_\delta\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta: \mathbb F(J) &\to \mathbb F(I)_\delta\\
        \end{aligned}
    \end{equation*}
    which induce the pair of $\delta$-interleaved morphisms
    \begin{equation*}
        \begin{aligned}[c]
        \phi_\delta: V_Y &\to {W_Y}_\delta\\
        \end{aligned}
        \quad \text{and} \quad
        \begin{aligned}[c]
        \psi_\delta: W_Y &\to {V_Y}_\delta.\\
        \end{aligned}
    \end{equation*}
    Not matched intervals are of length smaller than $ 2 \delta $, therefore both, $V_N$ and $V_Y$ are $\delta$-interleaved with the empty set. We can now construct the $\delta$-interleaving morphism $ \phi: V \to W$ such as $\phi \vert_{V_Y} = \phi_Y$ and $\phi \vert_{V_N} = 0$ and, in a similar way, we also construct $ \psi: W \to V$.
\end{proof}

Let $V$ be a persistence module and $ I = (b, d]$ an interval with $ d \in \R \cup \{+ \infty\}$. We denote $ \barc_{I-}(V) = \left\{ (a, b] \in \barc(V) : a \leq b\right\}$. Analogously, for an interval $ I = (b, d] $ we denote $ \barc_{I+}(V) = \left\{ (b, c] \in \barc(V) : c \geq d\right\}$. Let $ \# $ denote the cardinal operator.

\begin{lemma} % Polterovich Prop. 3.1.1
    Let $ I = (b, d] $ be an interval. It exists an injective morphism $i: (V, \pi) \in (W, \theta) $, then $\# \barc_{I-}(V) \leq \# \barc_{I-}(W) $.
\end{lemma}
\begin{proof} (INCOMPLETE)
    Let $ E_{I-} = \bigcap_{b < s < d} \operatorname{im} \pi_{s\leq d} \cup \bigcup_{r> d} \ker \pi_{d \leq r} \subseteq V_d $.
    $$
    \begin{tikzcd}
        V_s \arrow[r, "\pi_{s \leq r}"] \arrow[d, "p_s"'] & V_r \arrow[d, "p_r"] \\
        W_s \arrow[r, "\theta_{s \leq r}"']               & W_r
    \end{tikzcd}
    $$
\end{proof}

\begin{lemma} % Polterovich Prop. 3.1.3
    Let $ I = (b, d] $ be an interval. It exists a surjective morphism $s: (V, \pi) \in (W, \theta) $, then $\# \barc_{I+}(V) \geq \# \barc_{I+}(W) $.
\end{lemma}

\begin{lemma}
    If there exists an injection $i: (V, \pi) \in (W, \theta) $, then the induced matching $ \mu_{inj}: \barc(V) \to \barc (W) $ satisfies:
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{inj} = \barc(V)$,
        \item $\mu_{inj}(b, d] = (c, d], \ \forall c \leq b, \ \forall (b, d] \in \barc(V)$.
    \end{enumerate}
\end{lemma}

\begin{lemma}
    If there exists a surjection $s: (V, \pi) \in (W, \theta) $, then the induced matching $ \mu_{inj}: \barc(V) \to \barc (W) $ satisfies:
    \begin{enumerate}
        \item $\operatorname{im} \mu_{inj} = \barc(W)$,
        \item $\mu_{inj}(b, d] = (b, e], \ \forall b \geq e, \ \forall (b, e] \in \barc(V)$.
    \end{enumerate}
\end{lemma}

\begin{lemma}
    Let $ (V, \pi), (W, \theta) $ are $\delta$-interleaved persistence modules, with $\delta$-interleaving morphisms $ \phi: V \to W_\delta $ and $ \psi: W \to V_\delta $. Let $ \phi: V \to \operatorname{im}\phi $ be a surjection and $ \mu_{sur}: \barc(V) \to \barc (\operatorname{im} \phi)$ the induced matching. Then
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{sur} \supseteq \barc (V)_{\geq 2\delta} $,
        \item $ \operatorname{im} \mu_{sur} = \barc (\operatorname{im} \phi)$ and
        \item $ \mu_{sur}(b, d] = (b, d'], \ (b, d'] \in \operatorname{coim} \mu_{sur}, \ d' \in [d-2\delta, d]$.
    \end{enumerate}
\end{lemma}

\begin{lemma}
    Let $ (V, \pi), (W, \theta) $ are $\delta$-interleaved persistence modules, with $\delta$-interleaving morphisms $ \phi: V \to W_\delta $ and $ \psi: W \to V_\delta $. Let $ \phi: V \to \operatorname{im}\phi $ be a injection and $ \mu_{inj}: \barc(\operatorname{im} \phi) \to \barc (W_\delta)$ the induced matching. Then
    \begin{enumerate}
        \item $\operatorname{coim} \mu_{sur} = \barc (\operatorname{im} \phi) $,
        \item $ \operatorname{im} \mu_{inj} \supseteq \barc (W_\delta)_{\geq 2\delta} $ and
        \item $ \mu_{inj}(b, d'] = (b', d'], \ (b, d'] \in \operatorname{coim} \mu_{inj}, \ b' \in [b-2\delta, b]$.
    \end{enumerate}
\end{lemma}

\begin{proposition}\label{mathing-if-interleaving}
    Given two persistence modules $ V $, $ W $, if there is a $\delta$-interleaving morphism between them, then there is a $ \delta$-matching between their barcodes.
\end{proposition}

\begin{theorem}[Stability]
    There is an isometry between a persistence module with the interleaving distance and its barcode with the bottleneck distance. This means that, given two persistence modules $ V, \ W $, 
    $$ 
        d_{int} (V, W) = d_{bot} (\barc(V), \barc(W)).
    $$
\end{theorem}
\begin{proof}
    Suppose $ d_{int}(V, W) = \delta $. Proposition \ref{mathing-if-interleaving} asures there exist a $\delta$-matching between $ \barc(V) $ and $ \barc (W) $. As $ d_{bot}(V, W) $ is the infimum $\delta$ for witch exists a $\delta$-matching, $ d_{bot}(V, W) \leq d_{int}(V, W)$. On the other hand, Proposition \ref{interleaving-if-mathing} leads, with the same reasoning, to $ d_{int}(V, W) \leq d_{bot}(V, W)$. Thus, it has to be $ d_{int} (V, W) = d_{bot} (\barc(V), \barc(W)) $.
\end{proof}
